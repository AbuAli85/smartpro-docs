import{m as Q,r as n,j as e,g as me,B as o,W as E,D as he,aH as ue,aI as pe,aJ as ge,aK as H,aL as je,aM as C,u as Y,y as fe,aN as ye,b as S,c as _,d as T,aO as R,e as Z}from"./index-DIo96AMZ.js";import{B as p}from"./badge-H49p9_qL.js";import{C as ee}from"./checkbox-BbL1r8KU.js";import{S as J,a as q,b as W,c as K,d}from"./select-DyQSLHyb.js";import{I as ve}from"./input-XW9KhG0P.js";import{g as Ne,S as we}from"./service-images-D2dqDYpX.js";import{U as ae}from"./user-BlDytmZH.js";import{R as P}from"./refresh-cw-BYeEWKck.js";import{E as se}from"./eye-Cdb6Rdaw.js";import{T as be,P as Se}from"./trash-2-veRxRh1J.js";import{C as Ce}from"./circle-x-DY0zhxzN.js";import{u as ke}from"./useServices-D-vQJTLr.js";import"./services-DW1evicl.js";const Ae=Q("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const De=Q("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const Le=Q("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);function _e({services:f,onViewService:y,onEditService:M,onDeleteService:v,onApproveService:g,onSuspendService:k,onFeatureService:N,searchQueryExternal:i,statusFilterExternal:m,categoryFilterExternal:j,hideInternalFilters:F,selectable:h,selectedIds:x=[],onSelectionChange:w,disableClientSorting:O,allowFeature:U=!0,recentlyApproved:V=new Set}){const[b,$]=n.useState(i??""),[A,D]=n.useState(j??"all"),[u,l]=n.useState(m??"all"),[c,B]=n.useState("created_at"),[z,te]=n.useState("desc"),[le,X]=n.useState(new Set),G=s=>x.includes(s),re=s=>{if(!w)return;const a=G(s)?x.filter(t=>t!==s):[...x,s];w(a)},ie=()=>{if(!w)return;const s=L.map(t=>t.id),a=s.every(t=>x.includes(t));w(a?x.filter(t=>!s.includes(t)):Array.from(new Set([...x,...s])))};n.useEffect(()=>{typeof i=="string"&&$(i)},[i]),n.useEffect(()=>{typeof j=="string"&&D(j)},[j]),n.useEffect(()=>{typeof m=="string"&&l(m)},[m]);const ne=["Digital Marketing","Legal Services","Accounting","IT Services","Design & Branding","Consulting","Translation","HR Services","Web Development","Content Creation"],L=f.filter(s=>{const a=(s?.title||"").toLowerCase().includes(b.toLowerCase())||(s?.description||"").toLowerCase().includes(b.toLowerCase())||(s?.provider?.full_name||"").toLowerCase().includes(b.toLowerCase()),t=A==="all"||s.category===A,r=u==="all"||s.status===u;return a&&t&&r}).sort((s,a)=>{if(O)return 0;let t,r;switch(c){case"title":t=s.title.toLowerCase(),r=a.title.toLowerCase();break;case"price":t=s.base_price,r=a.base_price;break;case"created_at":default:t=new Date(s.created_at).getTime(),r=new Date(a.created_at).getTime();break}return z==="asc"?t>r?1:-1:t<r?1:-1}),ce=async(s,a)=>{if(a==="view"){y(s);return}X(t=>new Set(t).add(s.id));try{switch(a){case"approve":g&&await g(s),C.success("Service approved successfully");break;case"suspend":k&&await k(s),C.success("Service suspended successfully");break;case"feature":N&&await N(s),C.success("Service featured successfully");break;default:break}}catch{C.error(`Failed to ${a} service`)}finally{X(t=>{const r=new Set(t);return r.delete(s.id),r})}},de=s=>{const a=[];return a.push({label:"View Details",icon:se,action:"view",color:"text-blue-600"}),s.approval_status==="pending"&&g&&a.push({label:"Approve",icon:Y,action:"approve",color:"text-green-600"}),s.status==="active"&&k&&a.push({label:"Suspend",icon:Ce,action:"suspend",color:"text-red-600"}),s.status==="suspended"&&g&&a.push({label:"Reactivate",icon:Y,action:"approve",color:"text-green-600"}),U&&!s.featured&&N&&a.push({label:"Feature",icon:E,action:"feature",color:"text-yellow-600"}),a.slice(0,4)},oe=s=>{const a=s.status,t=s.approval_status,r=V.has(s.id);if(t==="pending")return e.jsx(p,{variant:"outline",className:"text-yellow-600 border-yellow-200 bg-yellow-50",children:"Pending Approval"});if(t==="approved"&&a!=="active")return e.jsx(p,{variant:"outline",className:`text-blue-600 border-blue-200 bg-blue-50 ${r?"animate-pulse ring-2 ring-blue-300":""}`,children:r?"✅ Just Approved":"Approved"});switch(a){case"active":return e.jsx(p,{variant:"outline",className:`text-green-600 border-green-200 bg-green-50 ${r?"animate-pulse ring-2 ring-green-300":""}`,children:r?"✅ Just Approved":"Active"});case"suspended":return e.jsx(p,{variant:"outline",className:"text-red-600 border-red-200 bg-red-50",children:"Suspended"});case"inactive":return e.jsx(p,{variant:"outline",className:"text-gray-600 border-gray-200 bg-gray-50",children:"Inactive"});default:return e.jsx(p,{variant:"outline",children:"Unknown"})}};return e.jsxs("div",{className:"space-y-4",children:[!F&&e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ve,{placeholder:"Search services...",value:b,onChange:s=>$(s.target.value),className:"pl-10"})]}),e.jsxs(J,{value:A,onValueChange:D,children:[e.jsx(q,{children:e.jsx(W,{placeholder:"All Categories"})}),e.jsxs(K,{children:[e.jsx(d,{value:"all",children:"All Categories"}),ne.map(s=>e.jsx(d,{value:s,children:s},s))]})]}),e.jsxs(J,{value:u,onValueChange:l,children:[e.jsx(q,{children:e.jsx(W,{placeholder:"All Status"})}),e.jsxs(K,{children:[e.jsx(d,{value:"all",children:"All Status"}),e.jsx(d,{value:"active",children:"Active"}),e.jsx(d,{value:"suspended",children:"Suspended"}),e.jsx(d,{value:"inactive",children:"Inactive"}),e.jsx(d,{value:"pending",children:"Pending Approval"})]})]}),e.jsxs(J,{value:c,onValueChange:B,children:[e.jsx(q,{children:e.jsx(W,{placeholder:"Sort by"})}),e.jsxs(K,{children:[e.jsx(d,{value:"created_at",children:"Date Created"}),e.jsx(d,{value:"title",children:"Title"}),e.jsx(d,{value:"price",children:"Price"})]})]}),e.jsxs(o,{variant:"outline",onClick:()=>te(z==="asc"?"desc":"asc"),className:"flex items-center space-x-2",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:z==="asc"?"Ascending":"Descending"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed min-w-[1100px]",children:[e.jsxs("colgroup",{children:[h&&e.jsx("col",{className:"w-10"}),e.jsx("col",{className:"w-[38%]"}),e.jsx("col",{className:"w-[14%]"}),e.jsx("col",{className:"w-[12%]"}),e.jsx("col",{className:"w-[10%]"}),e.jsx("col",{className:"w-[8%]"}),e.jsx("col",{className:"w-[8%]"}),e.jsx("col",{className:"w-[10%]"})]}),e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[h&&e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:e.jsx(ee,{checked:L.length>0&&L.every(s=>x.includes(s.id)),onCheckedChange:ie,"aria-label":"Select all"})}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Service"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Provider"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Category"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Price"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-900",children:"Rating"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:h?9:8,className:"py-10 text-center text-gray-500",children:"No services found. Adjust filters or search."})}):L.map(s=>{const a=le.has(s.id),t=de(s),r=V.has(s.id);return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 transition-colors ${r?"bg-green-50 border-green-200 animate-pulse":""}`,children:[h&&e.jsx("td",{className:"py-4 px-4 align-middle",children:e.jsx(ee,{checked:G(s.id),onCheckedChange:()=>re(s.id),"aria-label":`Select ${s?.title||"Service"}`})}),e.jsx("td",{className:"py-4 px-4 align-top",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"relative w-12 h-12 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:Ne(s.category,s.title,s.cover_image_url,48,48),alt:`${s?.title||"Service"} - ${s.category} service`,className:"object-cover w-full h-full"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s?.title||"Service"}),e.jsx("div",{className:"text-sm text-gray-500 line-clamp-1 sm:line-clamp-2",children:s.description}),s.featured&&e.jsxs(p,{variant:"outline",className:"text-xs text-yellow-600 border-yellow-200 bg-yellow-50 mt-1",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"Featured"]})]})]})}),e.jsx("td",{className:"py-4 px-4 align-middle",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(ae,{className:"h-4 w-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:s.provider?.full_name||"Unknown"}),s.provider?.company_name&&e.jsx("div",{className:"text-xs text-gray-500",children:s.provider.company_name})]})]})}),e.jsx("td",{className:"py-4 px-4 align-middle",children:e.jsx(p,{variant:"secondary",className:"text-xs",children:s.category})}),e.jsx("td",{className:"py-4 px-4 align-middle text-right whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center space-x-1",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.base_price}),e.jsx("span",{className:"text-sm text-gray-500",children:s.currency})]})}),e.jsx("td",{className:"py-4 px-4 align-middle text-center",children:oe(s)}),e.jsx("td",{className:"py-4 px-4 align-middle text-center whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center space-x-1",children:[e.jsx(E,{className:"h-4 w-4 text-yellow-400 fill-yellow-400"}),e.jsx("span",{className:"text-sm font-medium",children:"N/A"})]})}),e.jsx("td",{className:"py-4 px-4 align-middle text-right",children:e.jsxs("div",{className:"inline-flex items-center space-x-2",children:[t.map((I,xe)=>e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>ce(s,I.action),disabled:a,className:`h-8 w-8 p-0 ${I.color} hover:bg-gray-100`,title:I.label,children:a?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(I.icon,{className:"h-4 w-4"})},xe)),e.jsxs(ue,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Ae,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsxs(H,{onClick:()=>y(s),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(H,{onClick:()=>M(s),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Edit Service"]}),e.jsx(je,{}),e.jsxs(H,{onClick:()=>v(s),className:"text-red-600",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Delete Service"]})]})]})]})})]},s.id)})})]})})})]})}function He(){const[,f]=fe(),{user:y,signOut:M}=ye(),[v,g]=n.useState([]),[k,N]=n.useState(new Set),{services:i,loading:m,error:j,deleteService:F,updateService:h,refetch:x}=ke({status:"all",page:1,limit:100}),w=l=>{f(`/marketplace/services/${l.id}`)},O=l=>{f(`/marketplace/services/${l.id}/edit`)},U=async l=>{if(confirm(`Are you sure you want to delete "${l.title}"?`))try{await F(l.id)}catch{}},V=async l=>{try{await h(l.id,{approval_status:"approved",status:"active"}),N(c=>new Set(c).add(l.id)),setTimeout(()=>{N(c=>{const B=new Set(c);return B.delete(l.id),B})},3e3)}catch{}},b=async l=>{try{await h(l.id,{status:"suspended"})}catch{}},$=async l=>{try{await h(l.id,{featured:!0})}catch{}},A=()=>{f("/marketplace/services/create")},D=()=>{x(),C.success("Services refreshed")};if(m&&i.length===0)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Loading services..."})]})})});if(j&&i.length===0)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(S,{className:"border-red-200 bg-red-50",children:[e.jsxs(_,{children:[e.jsx(T,{className:"text-red-600",children:"Error Loading Services"}),e.jsx(R,{children:j})]}),e.jsx(Z,{children:e.jsxs(o,{onClick:D,variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Try Again"]})})]})});const u={total:i.length,active:i.filter(l=>l.status==="active").length,pending:i.filter(l=>l.approval_status==="pending").length,suspended:i.filter(l=>l.status==="suspended").length};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Services"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your service offerings"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:y.email})]}),e.jsx(o,{variant:"outline",onClick:()=>M(),children:"Sign Out"})]}):e.jsxs(o,{variant:"outline",onClick:()=>f("/marketplace/auth/sign-in"),children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Sign In"]}),e.jsxs(o,{variant:"outline",onClick:D,disabled:m,children:[e.jsx(P,{className:`h-4 w-4 mr-2 ${m?"animate-spin":""}`}),"Refresh"]}),y&&e.jsxs(o,{onClick:A,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Create Service"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(S,{children:e.jsxs(_,{className:"pb-3",children:[e.jsx(R,{children:"Total Services"}),e.jsx(T,{className:"text-2xl",children:u.total})]})}),e.jsx(S,{children:e.jsxs(_,{className:"pb-3",children:[e.jsx(R,{children:"Active"}),e.jsx(T,{className:"text-2xl text-green-600",children:u.active})]})}),e.jsx(S,{children:e.jsxs(_,{className:"pb-3",children:[e.jsx(R,{children:"Pending Approval"}),e.jsx(T,{className:"text-2xl text-yellow-600",children:u.pending})]})}),e.jsx(S,{children:e.jsxs(_,{className:"pb-3",children:[e.jsx(R,{children:"Suspended"}),e.jsx(T,{className:"text-2xl text-red-600",children:u.suspended})]})})]}),e.jsx(_e,{services:i,onViewService:w,onEditService:O,onDeleteService:U,onApproveService:V,onSuspendService:b,onFeatureService:$,selectable:!0,selectedIds:v,onSelectionChange:g,allowFeature:!0,recentlyApproved:k}),v.length>0&&e.jsx(S,{className:"mt-4 border-blue-200 bg-blue-50",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-blue-700",children:[v.length," service",v.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{C.info("Bulk approve feature coming soon")},children:"Approve Selected"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>g([]),children:"Clear Selection"})]})]})})})]})}export{He as default};
